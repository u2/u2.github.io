<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Solidity by Example &mdash; Solidity 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Solidity 0.2.0 documentation" href="index.html" />
    <link rel="next" title="Solidity in Depth" href="solidity-in-depth.html" />
    <link rel="prev" title="Installing Solidity" href="installing-solidity.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="solidity-in-depth.html" title="Solidity in Depth"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installing-solidity.html" title="Installing Solidity"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Solidity 0.2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="solidity-by-example">
<h1>Solidity by Example<a class="headerlink" href="#solidity-by-example" title="Permalink to this headline">¶</a></h1>
<div class="section" id="voting">
<span id="index-0"></span><span id="id1"></span><h2>Voting<a class="headerlink" href="#voting" title="Permalink to this headline">¶</a></h2>
<p>The following contract is quite complex, but showcases
a lot of Solidity&#8217;s features. It implements a voting
contract. Of course, the main problems of electronic
voting is how to assign voting rights to the correct
persons and how to prevent manipulation. We will not
solve all problems here, but at least we will show
how delegated voting can be done so that vote counting
is <strong>automatic and completely transparent</strong> at the
same time.</p>
<p>The idea is to create one contract per ballot,
providing a short name for each option.
Then the creator of the contract who serves as
chairperson will give the right to vote to each
address individually.</p>
<p>The persons behind the addresses can then choose
to either vote themselves or to delegate their
vote to a person they trust.</p>
<p>At the end of the voting time, <cite>winningProposal()</cite>
will return the proposal with the largest number
of votes.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span class="cs">/// </span><span class="k">@title</span><span class="cs"> Voting with delegation.</span>
<span class="kd">contract</span> <span class="nx">Ballot</span>
<span class="p">{</span>
    <span class="c1">// This declares a new complex type which will</span>
    <span class="c1">// be used for variables later.</span>
    <span class="c1">// It will represent a single voter.</span>
    <span class="kd">struct</span> <span class="nx">Voter</span>
    <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">weight</span><span class="p">;</span> <span class="c1">// weight is accumulated by delegation</span>
        <span class="kt">bool</span> <span class="nx">voted</span><span class="p">;</span>  <span class="c1">// if true, that person already voted</span>
        <span class="kt">address</span> <span class="nx">delegate</span><span class="p">;</span> <span class="c1">// person delegated to</span>
        <span class="kt">uint</span> <span class="nx">vote</span><span class="p">;</span>   <span class="c1">// index of the voted proposal</span>
    <span class="p">}</span>
    <span class="c1">// This is a type for a single proposal.</span>
    <span class="kd">struct</span> <span class="nx">Proposal</span>
    <span class="p">{</span>
        <span class="kt">bytes32</span> <span class="nx">name</span><span class="p">;</span>   <span class="c1">// short name (up to 32 bytes)</span>
        <span class="kt">uint</span> <span class="nx">voteCount</span><span class="p">;</span> <span class="c1">// number of accumulated votes</span>
    <span class="p">}</span>

    <span class="kt">address</span> <span class="k">public</span> <span class="nx">chairperson</span><span class="p">;</span>
    <span class="c1">// This declares a state variable that</span>
    <span class="c1">// stores a `Voter` struct for each possible address.</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="nx">Voter</span><span class="p">)</span> <span class="k">public</span> <span class="nx">voters</span><span class="p">;</span>
    <span class="c1">// A dynamically-sized array of `Proposal` structs.</span>
    <span class="nx">Proposal</span><span class="p">[]</span> <span class="k">public</span> <span class="nx">proposals</span><span class="p">;</span>

    <span class="cs">/// Create a new ballot to choose one of `proposalNames`.</span>
    <span class="kd">function</span> <span class="nx">Ballot</span><span class="p">(</span><span class="kt">bytes32</span><span class="p">[]</span> <span class="nx">proposalNames</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">chairperson</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">voters</span><span class="p">[</span><span class="nx">chairperson</span><span class="p">].</span><span class="nx">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="c1">// For each of the provided proposal names,</span>
        <span class="c1">// create a new proposal object and add it</span>
        <span class="c1">// to the end of the array.</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">proposalNames</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
            <span class="c1">// `Proposal({...})` creates a temporary</span>
            <span class="c1">// Proposal object and `proposal.push(...)`</span>
            <span class="c1">// appends it to the end of `proposals`.</span>
            <span class="nx">proposals</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Proposal</span><span class="p">({</span>
                <span class="nx">name</span><span class="o">:</span> <span class="nx">proposalNames</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
                <span class="nx">voteCount</span><span class="o">:</span> <span class="mi">0</span>
            <span class="p">}));</span>
    <span class="p">}</span>

    <span class="c1">// Give `voter` the right to vote on this ballot.</span>
    <span class="c1">// May only be called by `chairperson`.</span>
    <span class="kd">function</span> <span class="nx">giveRightToVote</span><span class="p">(</span><span class="kt">address</span> <span class="nx">voter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">!=</span> <span class="nx">chairperson</span> <span class="o">||</span> <span class="nx">voters</span><span class="p">[</span><span class="nx">voter</span><span class="p">].</span><span class="nx">voted</span><span class="p">)</span>
            <span class="c1">// `throw` terminates and reverts all changes to</span>
            <span class="c1">// the state and to Ether balances. It is often</span>
            <span class="c1">// a good idea to use this if functions are</span>
            <span class="c1">// called incorrectly. But watch out, this</span>
            <span class="c1">// will also consume all provided gas.</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="nx">voters</span><span class="p">[</span><span class="nx">voter</span><span class="p">].</span><span class="nx">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Delegate your vote to the voter `to`.</span>
    <span class="kd">function</span> <span class="nx">delegate</span><span class="p">(</span><span class="kt">address</span> <span class="nx">to</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// assigns reference</span>
        <span class="nx">Voter</span> <span class="nx">sender</span> <span class="o">=</span> <span class="nx">voters</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">sender</span><span class="p">.</span><span class="nx">voted</span><span class="p">)</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="c1">// Forward the delegation as long as</span>
        <span class="c1">// `to` also delegated.</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">voters</span><span class="p">[</span><span class="nx">to</span><span class="p">].</span><span class="nx">delegate</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
               <span class="nx">voters</span><span class="p">[</span><span class="nx">to</span><span class="p">].</span><span class="nx">delegate</span> <span class="o">!=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">)</span>
            <span class="nx">to</span> <span class="o">=</span> <span class="nx">voters</span><span class="p">[</span><span class="nx">to</span><span class="p">].</span><span class="nx">delegate</span><span class="p">;</span>
        <span class="c1">// We found a loop in the delegation, not allowed.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">to</span> <span class="o">==</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">)</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="c1">// Since `sender` is a reference, this</span>
        <span class="c1">// modifies `voters[msg.sender].voted`</span>
        <span class="nx">sender</span><span class="p">.</span><span class="nx">voted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">sender</span><span class="p">.</span><span class="nx">delegate</span> <span class="o">=</span> <span class="nx">to</span><span class="p">;</span>
        <span class="nx">Voter</span> <span class="nx">delegate</span> <span class="o">=</span> <span class="nx">voters</span><span class="p">[</span><span class="nx">to</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">delegate</span><span class="p">.</span><span class="nx">voted</span><span class="p">)</span>
            <span class="c1">// If the delegate already voted,</span>
            <span class="c1">// directly add to the number of votes</span>
            <span class="nx">proposals</span><span class="p">[</span><span class="nx">delegate</span><span class="p">.</span><span class="nx">vote</span><span class="p">].</span><span class="nx">voteCount</span> <span class="o">+=</span> <span class="nx">sender</span><span class="p">.</span><span class="nx">weight</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="c1">// If the delegate did not vote yet,</span>
            <span class="c1">// add to her weight.</span>
            <span class="nx">delegate</span><span class="p">.</span><span class="nx">weight</span> <span class="o">+=</span> <span class="nx">sender</span><span class="p">.</span><span class="nx">weight</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Give your vote (including votes delegated to you)</span>
    <span class="cs">/// to proposal `proposals[proposal].name`.</span>
    <span class="kd">function</span> <span class="nx">vote</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">proposal</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">Voter</span> <span class="nx">sender</span> <span class="o">=</span> <span class="nx">voters</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">sender</span><span class="p">.</span><span class="nx">voted</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
        <span class="nx">sender</span><span class="p">.</span><span class="nx">voted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">sender</span><span class="p">.</span><span class="nx">vote</span> <span class="o">=</span> <span class="nx">proposal</span><span class="p">;</span>
        <span class="c1">// If `proposal` is out of the range of the array,</span>
        <span class="c1">// this will throw automatically and revert all</span>
        <span class="c1">// changes.</span>
        <span class="nx">proposals</span><span class="p">[</span><span class="nx">proposal</span><span class="p">].</span><span class="nx">voteCount</span> <span class="o">+=</span> <span class="nx">sender</span><span class="p">.</span><span class="nx">weight</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// </span><span class="k">@dev</span><span class="cs"> Computes the winning proposal taking all</span>
    <span class="cs">/// previous votes into account.</span>
    <span class="kd">function</span> <span class="nx">winningProposal</span><span class="p">()</span> <span class="k">constant</span>
            <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">winningProposal</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">winningVoteCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">p</span> <span class="o">&lt;</span> <span class="nx">proposals</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">p</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">proposals</span><span class="p">[</span><span class="nx">p</span><span class="p">].</span><span class="nx">voteCount</span> <span class="o">&gt;</span> <span class="nx">winningVoteCount</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nx">winningVoteCount</span> <span class="o">=</span> <span class="nx">proposals</span><span class="p">[</span><span class="nx">p</span><span class="p">].</span><span class="nx">voteCount</span><span class="p">;</span>
                <span class="nx">winningProposal</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="possible-improvements">
<h3>Possible Improvements<a class="headerlink" href="#possible-improvements" title="Permalink to this headline">¶</a></h3>
<p>Currently, many transactions are needed to assign the rights
to vote to all participants. Can you think of a better way?</p>
</div>
</div>
<div class="section" id="blind-auction">
<span id="index-1"></span><h2>Blind Auction<a class="headerlink" href="#blind-auction" title="Permalink to this headline">¶</a></h2>
<p>In this section, we will show how easy it is to create a
completely blind auction contract on Ethereum.
We will start with an open auction where everyone
can see the bids that are made and then extend this
contract into a blind auction where it is not
possible to see the actual bid until the bidding
period ends.</p>
<div class="section" id="simple-open-auction">
<h3>Simple Open Auction<a class="headerlink" href="#simple-open-auction" title="Permalink to this headline">¶</a></h3>
<p>The general idea of the following simple auction contract
is that everyone can send their bids during
a bidding period. The bids already include sending
money / ether in order to bind the bidders to their
bid. If the highest bid is raised, the previously
highest bidder gets her money back.
After the end of the bidding period, the
contract has to be called manually for the
beneficiary to receive his money - contracts cannot
activate themselves.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span class="kd">contract</span> <span class="nx">SimpleAuction</span> <span class="p">{</span>
    <span class="c1">// Parameters of the auction. Times are either</span>
    <span class="c1">// absolute unix timestamps (seconds since 1970-01-01)</span>
    <span class="c1">// ore time periods in seconds.</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">beneficiary</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">auctionStart</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">biddingTime</span><span class="p">;</span>

    <span class="c1">// Current state of the auction.</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">highestBidder</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">highestBid</span><span class="p">;</span>

    <span class="c1">// Set to true at the end, disallows any change</span>
    <span class="kt">bool</span> <span class="nx">ended</span><span class="p">;</span>

    <span class="c1">// Events that will be fired on changes.</span>
    <span class="kd">event</span> <span class="nx">HighestBidIncreased</span><span class="p">(</span><span class="kt">address</span> <span class="nx">bidder</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">);</span>
    <span class="kd">event</span> <span class="nx">AuctionEnded</span><span class="p">(</span><span class="kt">address</span> <span class="nx">winner</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">);</span>

    <span class="c1">// The following is a so-called natspec comment,</span>
    <span class="c1">// recognizable by the three slashes.</span>
    <span class="c1">// It will be shown when the user is asked to</span>
    <span class="c1">// confirm a transaction.</span>

    <span class="cs">/// Create a simple auction with `_biddingTime`</span>
    <span class="cs">/// seconds bidding time on behalf of the</span>
    <span class="cs">/// beneficiary address `_beneficiary`.</span>
    <span class="kd">function</span> <span class="nx">SimpleAuction</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_biddingTime</span><span class="p">,</span>
                           <span class="kt">address</span> <span class="nx">_beneficiary</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">beneficiary</span> <span class="o">=</span> <span class="nx">_beneficiary</span><span class="p">;</span>
        <span class="nx">auctionStart</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span>
        <span class="nx">biddingTime</span> <span class="o">=</span> <span class="nx">_biddingTime</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Bid on the auction with the value sent</span>
    <span class="cs">/// together with this transaction.</span>
    <span class="cs">/// The value will only be refunded if the</span>
    <span class="cs">/// auction is not won.</span>
    <span class="kd">function</span> <span class="nx">bid</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// No arguments are necessary, all</span>
        <span class="c1">// information is already part of</span>
        <span class="c1">// the transaction.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">now</span> <span class="o">&gt;</span> <span class="nx">auctionStart</span> <span class="o">+</span> <span class="nx">biddingTime</span><span class="p">)</span>
            <span class="c1">// Revert the call if the bidding</span>
            <span class="c1">// period is over.</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&lt;=</span> <span class="nx">highestBid</span><span class="p">)</span>
            <span class="c1">// If the bid is not higher, send the</span>
            <span class="c1">// money back.</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">highestBidder</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="nx">highestBidder</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">highestBid</span><span class="p">);</span>
        <span class="nx">highestBidder</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">highestBid</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="nx">HighestBidIncreased</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cs">/// End the auction and send the highest bid</span>
    <span class="cs">/// to the beneficiary.</span>
    <span class="kd">function</span> <span class="nx">auctionEnd</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">now</span> <span class="o">&lt;=</span> <span class="nx">auctionStart</span> <span class="o">+</span> <span class="nx">biddingTime</span><span class="p">)</span>
            <span class="k">throw</span><span class="p">;</span> <span class="c1">// auction did not yet end</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ended</span><span class="p">)</span>
            <span class="k">throw</span><span class="p">;</span> <span class="c1">// this function has already been called</span>
        <span class="nx">AuctionEnded</span><span class="p">(</span><span class="nx">highestBidder</span><span class="p">,</span> <span class="nx">highestBid</span><span class="p">);</span>
        <span class="c1">// We send all the money we have, because some</span>
        <span class="c1">// of the refunds might have failed.</span>
        <span class="nx">beneficiary</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">);</span>
        <span class="nx">ended</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// This function gets executed if a</span>
        <span class="c1">// transaction with invalid data is sent to</span>
        <span class="c1">// the contract or just ether without data.</span>
        <span class="c1">// We revert the send so that no-one</span>
        <span class="c1">// accidentally loses money when using the</span>
        <span class="c1">// contract.</span>
        <span class="k">throw</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>Blind Auction<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The previous open auction is extended to a blind auction
in the following. The advantage of a blind auction is
that there is no time pressure towards the end of
the bidding period. Creating a blind auction on a
transparent computing platform might sound like a
contradiction, but cryptography comes to the rescue.</p>
<p>During the <strong>bidding period</strong>, a bidder does not
actually send her bid, but only a hashed version of it.
Since it is currently considered practically impossible
to find two (sufficiently long) values whose hash
values are equal, the bidder commits to the bid by that.
After the end of the bidding period, the bidders have
to reveal their bids: They send their values
unencrypted and the contract checks that the hash value
is the same as the one provided during the bidding period.</p>
<p>Another challenge is how to make the auction
<strong>binding and blind</strong> at the same time: The only way to
prevent the bidder from just not sending the money
after he won the auction is to make her send it
together with the bid. Since value transfers cannot
be blinded in Ethereum, anyone can see the value.</p>
<p>The following contract solves this problem by
accepting any value that is at least as large as
the bid. Since this can of course only be checked during
the reveal phase, some bids might be <strong>invalid</strong>, and
this is on purpose (it even provides an explicit
flag to place invalid bids with high value transfers):
Bidders can confuse competition by placing several
high or low invalid bids.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span class="kd">contract</span> <span class="nx">BlindAuction</span>
<span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">Bid</span>
    <span class="p">{</span>
        <span class="kt">bytes32</span> <span class="nx">blindedBid</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">deposit</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">beneficiary</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">auctionStart</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">biddingEnd</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">revealEnd</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="k">public</span> <span class="nx">ended</span><span class="p">;</span>

    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="nx">Bid</span><span class="p">[])</span> <span class="k">public</span> <span class="nx">bids</span><span class="p">;</span>

    <span class="kt">address</span> <span class="k">public</span> <span class="nx">highestBidder</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">highestBid</span><span class="p">;</span>

    <span class="kd">event</span> <span class="nx">AuctionEnded</span><span class="p">(</span><span class="kt">address</span> <span class="nx">winner</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">highestBid</span><span class="p">);</span>

    <span class="cs">/// Modifiers are a convenient way to validate inputs to</span>
    <span class="cs">/// functions. `onlyBefore` is applied to `bid` below:</span>
    <span class="cs">/// The new function body is the modifier&#39;s body where</span>
    <span class="cs">/// `_` is replaced by the old function body.</span>
    <span class="kd">modifier</span> <span class="nx">onlyBefore</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_time</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">now</span> <span class="o">&gt;=</span> <span class="nx">_time</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span> <span class="nx">_</span> <span class="p">}</span>
    <span class="kd">modifier</span> <span class="nx">onlyAfter</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_time</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">now</span> <span class="o">&lt;=</span> <span class="nx">_time</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span> <span class="nx">_</span> <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">BlindAuction</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_biddingTime</span><span class="p">,</span>
                            <span class="kt">uint</span> <span class="nx">_revealTime</span><span class="p">,</span>
                            <span class="kt">address</span> <span class="nx">_beneficiary</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">beneficiary</span> <span class="o">=</span> <span class="nx">_beneficiary</span><span class="p">;</span>
        <span class="nx">auctionStart</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span>
        <span class="nx">biddingEnd</span> <span class="o">=</span> <span class="nx">now</span> <span class="o">+</span> <span class="nx">_biddingTime</span><span class="p">;</span>
        <span class="nx">revealEnd</span> <span class="o">=</span> <span class="nx">biddingEnd</span> <span class="o">+</span> <span class="nx">_revealTime</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Place a blinded bid with `_blindedBid` = sha3(value,</span>
    <span class="cs">/// fake, secret).</span>
    <span class="cs">/// The sent ether is only refunded if the bid is correctly</span>
    <span class="cs">/// revealed in the revealing phase. The bid is valid if the</span>
    <span class="cs">/// ether sent together with the bid is at least &quot;value&quot; and</span>
    <span class="cs">/// &quot;fake&quot; is not true. Setting &quot;fake&quot; to true and sending</span>
    <span class="cs">/// not the exact amount are ways to hide the real bid but</span>
    <span class="cs">/// still make the required deposit. The same address can</span>
    <span class="cs">/// place multiple bids.</span>
    <span class="kd">function</span> <span class="nx">bid</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">_blindedBid</span><span class="p">)</span>
        <span class="nx">onlyBefore</span><span class="p">(</span><span class="nx">biddingEnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">bids</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">Bid</span><span class="p">({</span>
            <span class="nx">blindedBid</span><span class="o">:</span> <span class="nx">_blindedBid</span><span class="p">,</span>
            <span class="nx">deposit</span><span class="o">:</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span>
        <span class="p">}));</span>
    <span class="p">}</span>

    <span class="cs">/// Reveal your blinded bids. You will get a refund for all</span>
    <span class="cs">/// correctly blinded invalid bids and for all bids except for</span>
    <span class="cs">/// the totally highest.</span>
    <span class="kd">function</span> <span class="nx">reveal</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="nx">_values</span><span class="p">,</span> <span class="kt">bool</span><span class="p">[]</span> <span class="nx">_fake</span><span class="p">,</span>
                    <span class="kt">bytes32</span><span class="p">[]</span> <span class="nx">_secret</span><span class="p">)</span>
        <span class="nx">onlyAfter</span><span class="p">(</span><span class="nx">biddingEnd</span><span class="p">)</span>
        <span class="nx">onlyBefore</span><span class="p">(</span><span class="nx">revealEnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">bids</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_values</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="nx">length</span> <span class="o">||</span> <span class="nx">_fake</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="nx">length</span> <span class="o">||</span>
                    <span class="nx">_secret</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="nx">length</span><span class="p">)</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">refund</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">bid</span> <span class="o">=</span> <span class="nx">bids</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">][</span><span class="nx">i</span><span class="p">];</span>
            <span class="kd">var</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">fake</span><span class="p">,</span> <span class="nx">secret</span><span class="p">)</span> <span class="o">=</span>
                    <span class="p">(</span><span class="nx">_values</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">_fake</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">_secret</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">bid</span><span class="p">.</span><span class="nx">blindedBid</span> <span class="o">!=</span> <span class="nx">sha3</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">fake</span><span class="p">,</span> <span class="nx">secret</span><span class="p">))</span>
                <span class="c1">// Bid was not actually revealed.</span>
                <span class="c1">// Do not refund deposit.</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="nx">refund</span> <span class="o">+=</span> <span class="nx">value</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fake</span> <span class="o">&amp;&amp;</span> <span class="nx">bid</span><span class="p">.</span><span class="nx">deposit</span> <span class="o">&gt;=</span> <span class="nx">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">placeBid</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">value</span><span class="p">))</span>
                    <span class="nx">refund</span> <span class="o">-=</span> <span class="nx">value</span><span class="p">;</span>
            <span class="c1">// Make it impossible for the sender to re-claim</span>
            <span class="c1">// the same deposit.</span>
            <span class="nx">bid</span><span class="p">.</span><span class="nx">blindedBid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">refund</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// This is an &quot;internal&quot; function which means that it</span>
    <span class="c1">// can only be called from the contract itself (or from</span>
    <span class="c1">// derived contracts).</span>
    <span class="kd">function</span> <span class="nx">placeBid</span><span class="p">(</span><span class="kt">address</span> <span class="nx">bidder</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span> <span class="k">internal</span>
            <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="nx">success</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&lt;=</span> <span class="nx">highestBid</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">highestBidder</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1">// Refund the previously highest bidder.</span>
            <span class="nx">highestBidder</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">highestBid</span><span class="p">);</span>
        <span class="nx">highestBid</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="nx">highestBidder</span> <span class="o">=</span> <span class="nx">bidder</span><span class="p">;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// End the auction and send the highest bid</span>
    <span class="cs">/// to the beneficiary.</span>
    <span class="kd">function</span> <span class="nx">auctionEnd</span><span class="p">()</span>
        <span class="nx">onlyAfter</span><span class="p">(</span><span class="nx">revealEnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ended</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
        <span class="nx">AuctionEnded</span><span class="p">(</span><span class="nx">highestBidder</span><span class="p">,</span> <span class="nx">highestBid</span><span class="p">);</span>
        <span class="c1">// We send all the money we have, because some</span>
        <span class="c1">// of the refunds might have failed.</span>
        <span class="nx">beneficiary</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">);</span>
        <span class="nx">ended</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">throw</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="safe-remote-purchase">
<span id="index-2"></span><h2>Safe Remote Purchase<a class="headerlink" href="#safe-remote-purchase" title="Permalink to this headline">¶</a></h2>
<div class="highlight-Solidity"><div class="highlight"><pre><span class="kd">contract</span> <span class="nx">Purchase</span>
<span class="p">{</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">value</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">seller</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">buyer</span><span class="p">;</span>
    <span class="kd">enum</span> <span class="nx">State</span> <span class="p">{</span> <span class="nx">Created</span><span class="p">,</span> <span class="nx">Locked</span><span class="p">,</span> <span class="nx">Inactive</span> <span class="p">}</span>
    <span class="nx">State</span> <span class="k">public</span> <span class="nx">state</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">Purchase</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">seller</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">value</span> <span class="o">!=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">modifier</span> <span class="nx">require</span><span class="p">(</span><span class="kt">bool</span> <span class="nx">_condition</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_condition</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
        <span class="nx">_</span>
    <span class="p">}</span>
    <span class="kd">modifier</span> <span class="nx">onlyBuyer</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">!=</span> <span class="nx">buyer</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
        <span class="nx">_</span>
    <span class="p">}</span>
    <span class="kd">modifier</span> <span class="nx">onlySeller</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">!=</span> <span class="nx">seller</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
        <span class="nx">_</span>
    <span class="p">}</span>
    <span class="kd">modifier</span> <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span> <span class="nx">_state</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">state</span> <span class="o">!=</span> <span class="nx">_state</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
        <span class="nx">_</span>
    <span class="p">}</span>
    <span class="kd">event</span> <span class="nx">aborted</span><span class="p">();</span>
    <span class="kd">event</span> <span class="nx">purchaseConfirmed</span><span class="p">();</span>
    <span class="kd">event</span> <span class="nx">itemReceived</span><span class="p">();</span>

    <span class="cs">/// Abort the purchase and reclaim the ether.</span>
    <span class="cs">/// Can only be called by the seller before</span>
    <span class="cs">/// the contract is locked.</span>
    <span class="kd">function</span> <span class="nx">abort</span><span class="p">()</span>
        <span class="nx">onlySeller</span>
        <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span><span class="p">.</span><span class="nx">Created</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">aborted</span><span class="p">();</span>
        <span class="nx">seller</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">);</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="nx">State</span><span class="p">.</span><span class="nx">Inactive</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cs">/// Confirm the purchase as buyer.</span>
    <span class="cs">/// Transaction has to include `2 * value` ether.</span>
    <span class="cs">/// The ether will be locked until confirmReceived</span>
    <span class="cs">/// is called.</span>
    <span class="kd">function</span> <span class="nx">confirmPurchase</span><span class="p">()</span>
        <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span><span class="p">.</span><span class="nx">Created</span><span class="p">)</span>
        <span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">purchaseConfirmed</span><span class="p">();</span>
        <span class="nx">buyer</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="nx">State</span><span class="p">.</span><span class="nx">Locked</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cs">/// Confirm that you (the buyer) received the item.</span>
    <span class="cs">/// This will release the locked ether.</span>
    <span class="kd">function</span> <span class="nx">confirmReceived</span><span class="p">()</span>
        <span class="nx">onlyBuyer</span>
        <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span><span class="p">.</span><span class="nx">Locked</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">itemReceived</span><span class="p">();</span>
        <span class="nx">buyer</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> <span class="c1">// We ignore the return value on purpose</span>
        <span class="nx">seller</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">);</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="nx">State</span><span class="p">.</span><span class="nx">Inactive</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">throw</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="micropayment-channel">
<h2>Micropayment Channel<a class="headerlink" href="#micropayment-channel" title="Permalink to this headline">¶</a></h2>
<p>To be written.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Solidity by Example</a><ul>
<li><a class="reference internal" href="#voting">Voting</a><ul>
<li><a class="reference internal" href="#possible-improvements">Possible Improvements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#blind-auction">Blind Auction</a><ul>
<li><a class="reference internal" href="#simple-open-auction">Simple Open Auction</a></li>
<li><a class="reference internal" href="#id2">Blind Auction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#safe-remote-purchase">Safe Remote Purchase</a></li>
<li><a class="reference internal" href="#micropayment-channel">Micropayment Channel</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installing-solidity.html"
                        title="previous chapter">Installing Solidity</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="solidity-in-depth.html"
                        title="next chapter">Solidity in Depth</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/solidity-by-example.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="solidity-in-depth.html" title="Solidity in Depth"
             >next</a> |</li>
        <li class="right" >
          <a href="installing-solidity.html" title="Installing Solidity"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Solidity 0.2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Ethereum.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
  </body>
</html>